{% extends "base.html" %}

{% load crispy_forms_tags %}

{% block content %}
<!-- Fixed Sidebar & Content-->
<div id="wrapper" class="toggled">

        {% include 'sidebar.html'%}
   
        <!-- Page Content -->
        <div class="container login-content col-sm-11" id="content-wrapper">
            <!-- Title content--> 
            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                        {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}Important: {% endif %}
                        {{ message }}
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="row">
                <div>
                    <a href="#menu-toggle" class="btn btn-primary" id="menu-toggle">
                        <i class="fas fa-angle-double-left" id="menu-toggle-icon"></i>
                    </a>
                    <h3 class="user-title">Trabajos</h3>
                </div>
            </div>
             <!-- EndTitle content-->

             <!-- First Row -->
             <div class="row">
               <div class="col-sm-12">
                   <div class="jumbotron RLcard">
                    <div class="col-sm-6">
                        <h2 class="text-left">Autor - Lista de trabajos</h2>
                    </div>

                    <br>
                           <table class="table table-bordered" id = "show-job">
                               <thead>
                                 <tr>
                                    <th class="col-sm-2">Título</th>
                                    <th class="col-sm-2">Área</th>
                                    <th class="col-sm-2">Subárea</th>
                                    <th class="col-sm-2">Autor(es)</th>
                                    <th class="col-sm-1">Estatus</th>
                                    <th class="col-sm-1">Versión</th>
                                    <th class="col-sm-2">Acciones</th>
                                 </tr>
                               </thead>
                               <tbody>
                                  {% for trabajo in trabajos %}
                                   <tr>
                                      <td>{{ trabajo.trabajo.titulo_espanol }}</td>
                                      <td>{{ trabajo.trabajo.area }}</td>
                                      <td>{{ trabajo.trabajo.subarea1 }}</td>
                                      <td>
                                          {{ trabajo.autor.nombres }} {{ trabajo.autor.apellidos }}
                                      </td>
                                      <td>
                                        {% if trabajo.trabajo.estatus == "Pendiente" %}
                                          <span class="label label-warning lb-md center-block">Pendiente</span>
                                        {% elif trabajo.trabajo.estatus == "Aprobado" %}
                                          <span class="label label-success lb-md center-block">Aprobado</span>
                                        {% elif trabajo.trabajo.estatus == "Rechazado" %}
                                          <span class="label label-danger lb-md center-block">Rechazado</span>
                                        {% endif %}
                                      </td>
                                      <td class="col-sm-1">2.0</td>
                                      <td class="col-sm-1 text-center">
                                          
                                      {% if trabajo.monto_total > 0 %}<!-- Esto es para corroborar que el trabajo no ha sido postulado, luego hay que cambiarlo por el valor inicial, ya que una vez hecho el pago no se puede eliminar o editar un trabajo-->
                                          <a href="{% url 'trabajos:edit_trabajo' trabajo.trabajo.id %}" class="btn btn-info" role="button" data-toggle="tooltip" data-placement="top" title="Editar">
                                              <i class="fas fa-edit"></i>
                                          </a>

                                          <!-- Esto es lo que hay que verificar -->
                                          <button class="btn btn-info show-form-delete" data-url="{% url 'trabajos:delete_job' trabajo.trabajo.id %}" title="Borrar">
                                              <i class="fas fa-times"></i>
                                          </button>
                                      


                                      {% endif %}
                                          <a href="{% url 'trabajos:detalles_trabajo' trabajo.trabajo.id %}" class="btn btn-info" role="button" title="Ver trabajo">
                                              <i class="fas fa-door-open"></i>
                                          </a>
                                      </td>
                                   </tr>
                                   {% endfor %}              
                               </tbody>
                             </table>
                           <!-- End table  -->
                          <div class="pagination">
                            <span class="step-links">
                                {% if trabajos.has_previous %}
                                    <a href="?page={{ trabajos.previous_page_number }}">previous</a>
                                {% endif %}

                                <span class="current">
                                    Page {{ trabajos.number }} of {{ trabajos.paginator.num_pages }}.
                                </span>

                                {% if trabajos.has_next %}
                                    <a href="?page={{ trabajos.next_page_number }}">next</a>
                                {% endif %}
                            </span>
                          </div>



                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a href="#accordion" class="btn btn-info btn-block" data-toggle="collapse">Crear Trabajo</a>
                            </div>
                            <div id="accordion" class="panel-body collapse">
                                <div class="container-fluid">
                                    <div class="row middle-content">
                                        <div class="col-sm-12">
                                            {% crispy form %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
               </div>
             </div>
             <!-- EndFirst Row -->
   
        </div>
</div>

<!-- modal -->
<div class="modal fade" id="modal-job">
  <div class="modal-dialog">
      <div class="modal-content">
        
      </div>
  </div>
</div>

{% endblock %}